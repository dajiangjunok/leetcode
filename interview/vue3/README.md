#### vue3设计目标

* 更小；更快；更友好；优化方案

vue2存在的问题

* 随着功能增长，复杂组件的代码变得越来越难以维护
* 缺少一种比较（干净）的在多个组件之间提取和复用逻辑的机制
* 类型推断不够友好
* bundle的时间太久了 

Vue3做到了更小，更快，TS支持，API设计一致性，提高自身可维护性，开放更多底层功能

1.更小（引入tree-shaking，可将无用模块剪辑，仅打包需要的，使打包的体积变小）

2.更快（diff算法优化，静态提升，事件监听缓存，ssr优化）

3.更友好（composition API 增加了代码的逻辑组织和代码复用能力）

源码管理

整体通过`monorepo`  的方式维护的，根据功能将不同的模块拆分到packages 目录下面不同的子目录中，这样使得模块拆分更细化，指责划分更明确，模块之间的依赖关系也更加明确，开发人员也更容易阅读和更改所有模块源码，提高代码的可维护性，另外一些 `package`（比如 `reactivity` 响应式库）是可以独立于 `Vue` 使用的，这样用户如果只想使用 `Vue3 `的响应式能力，可以单独依赖这个响应式库而不用去依赖整个 `Vue`，`Vue3`是基于`typeScript`编写的，提供了更好的类型检查，能支持复杂的类型推导

数据劫持方案的改变，`Object.defineProperty`, 这个API有一些缺陷，并不能检测对象属性添加和删除



#### Vue3 性能提升主要体现在哪些方面

* 编译阶段

Vue2 每个组件实例都对应一个 `watcher` 实例，它会在组件渲染的过程中把用到的数据`property`记录为依赖，当依赖发生改变，触发`setter`，则会通知`watcher`，从而使关联的组件重新渲染

```vue
<template>
    <div id="content">
        <p class="text">静态文本</p>
        <p class="text">静态文本</p>
        <p class="text">{{ message }}</p>
        <p class="text">静态文本</p>
        ...
        <p class="text">静态文本</p>
    </div>
</template>
```

可以看到，组件内部只有一个动态节点，剩余一堆都是静态节点，所以这里很多 `diff` 和遍历其实都是不需要的，造成性能浪费,因此，`Vue3`在编译阶段，做了进一步优化（diff算法优化，静态提升，事件监听缓存，SSR优化）

**diff算法优化**

Vue3 在diff算法中增加了静态标记，关于静态标记，起作用是为了会发生变化的地方添加一个`flag`标记，下次发生变化的时候直接找该地方进行比较

**静态提升**

`Vue3`中对不参与更新的元素，会做静态提升，只会被创建一次，在渲染时直接复用，这样就免去了重复的创建节点，大型应用会受益于这个改动，免去了重复的创建操作，优化了运行时候的内存占用

**事件监听缓存**

默认情况下绑定事件行为会被视为动态绑定，所以每次都会去追踪它的变化

**SSR优化**

当静态内容大到一定量级时候，会用`createStaticVNode`方法在客户端去生成一个static node，这些静态`node`，会被直接`innerHtml`，就不需要创建对象，然后根据对象渲染



* 代码体积

相比`Vue2`，`Vue3`整体体积变小了，除了移出一些不常用的API，最重要的是`Tree shanking`

任何一个函数，如`ref`、`reavtived`、`computed`等，仅仅在用到的时候才打包，没用到的模块都被摇掉，打包的整体体积变小



* 响应式系统

`vue2`中采用 `defineProperty`来劫持整个对象，然后进行深度遍历所有属性，给每个属性添加`getter`和`setter`，实现响应式

`vue3`采用`proxy`重写了响应式系统，因为`proxy`可以对整个对象进行监听，所以不需要深度遍历

- 可以监听动态属性的添加
- 可以监听到数组的索引和数组`length`属性
- 可以监听删除属性



#### vue3中的treeshaking特性

```
Tree shaking` 是一种通过清除多余代码方式来优化项目打包体积的技术，专业术语叫 `Dead code elimination
```

在`Vue2`中，无论我们使用什么功能，它们最终都会出现在生产代码中。主要原因是`Vue`实例在项目中是单例的，捆绑程序无法检测到该对象的哪些属性在代码中被使用到，而`Vue3`源码引入`tree shaking`特性，将全局 API 进行分块。如果您不使用其某些功能，它们将不会包含在您的基础包中



通过`Tree shaking`，`Vue3`给我们带来的好处是：

- 减少程序体积（更小）
- 减少程序执行时间（更快）
- 便于将来对程序架构进行优化（更友好）



#### Vue3 实现一个model组件

1.组件设计。2.需求分析。3.实现流程